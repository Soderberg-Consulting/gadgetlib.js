!function(){function n(){return e("get-environment")}function t(){var n={},t=location.href.split(/[\?&]/),e=t.splice(1);n.url=t[0];for(var o,i,a,s=0;s<e.length;s++)o=e[s].split("="),i=o[0],a=o[1],n[i]=a;r.set(n)}function e(n,t){var e=r,o=null,i=Math.random().toString().slice(2),a={name:n,gid:e.gid,origin:e.url,token:e.token,place:e.place,payload:t,callback:i};o=new $.Deferred;var s=function(n){if(n.origin==e.msghost){var t=n.data;if("string"==typeof t)try{t=JSON.parse(t)}catch(r){return void console.log("Cannot parse message from OU Campus app:",t)}console.log("Response from OU Campus:",t),t.callback==i&&(window.removeEventListener("message",s,!1),o.resolve(t.payload))}};return window.addEventListener("message",s,!1),window.top.postMessage(JSON.stringify(a),e.msghost),o}function o(n){var t=r;if(n.origin==t.msghost){var e=n.data;if("string"==typeof e)try{e=JSON.parse(e)}catch(o){return void console.log("Cannot parse message from OU Campus app:",e)}e.callback||(console.log("Message from OU Campus:",e),"configuration"==e.name&&t.setConfig(e.payload),$(t).trigger(e.name,e.payload))}}var r={ready:function(n){var t=new $.Deferred;return this.isReady?(n&&n(),t.resolve()):$(this).one("ready",function(){n&&n(),t.resolve()}),t},get:function(n){return"object"==typeof this[n]?JSON.parse(JSON.stringify(this[n])):this[n]},set:function(n,t){if("string"==typeof n)this[n]=t;else for(var e in n)n.hasOwnProperty(e)&&(this[e]=n[e])},getConfig:function(n){return"object"==typeof this.config[n]?JSON.parse(JSON.stringify(this.config[n])):this.config[n]},setConfig:function(n,t){if("string"==typeof n)this.config[n]=t;else for(var e in n)n.hasOwnProperty(e)&&(this.config[e]=n[e])},fetch:function(){var n=this,t=n.apihost+"/gadgets/view",e={authorization_token:n.token,account:n.account,gadget:n.gid};return $.ajax({type:"GET",url:t,data:e,success:function(t){n.config={};for(var e in t.config)t.config.hasOwnProperty(e)&&(n.config[e]=t.config[e].value)},error:function(n,t,e){console.log("Fetch error:",t,e)}})},save:function(n,t){n&&this.setConfig(n,t);var e=this,o=e.apihost+"/gadgets/configure",r=e.config;return r.authorization_token=e.token,r.account=e.account,r.gadget=e.gid,$.ajax({type:"POST",url:o,data:r,success:function(n){},error:function(n,t,e){console.log("Save error:",t,e)}})},_sendMessageToTop:e,oucGetCurrentFileInfo:function(){return e("get-current-file-info")},oucInsertAtCursor:function(n){return e("insert-at-cursor",n)},oucGetCurrentLocation:function(){return e("get-location")},oucSetCurrentLocation:function(n){return e("set-location",n)},oucGetWYSIWYGSelection:function(){return e("get-wysiwyg-selection")},oucGetWYSIWYGContent:function(){return e("get-wysiwyg-content")}};for(var i in r)r[i]=r[i].bind(r);r.set(t()),n().then(function(n){"Unrecognized message."!=n&&r.set(n),r.isReady=!0,$(r).trigger("ready")}),window.addEventListener("message",o,!1),window.gadget=r,window.Gadget=function(){},window.Gadget.prototype=r}();